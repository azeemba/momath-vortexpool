import {Vector} from 'p5';
import VP from './vortexpanel';

class Simulation {
    constructor(paths) {
        //console.log('New Simulation');
        //if (!paths)
        //    paths = [[{"y": 0.001257, "x": 1.000084}, {"y": 0.001575, "x": 0.998557}, {"y": 0.002524, "x": 0.993984}, {"y": 0.004086, "x": 0.986392}, {"y": 0.006231, "x": 0.975825}, {"y": 0.008922, "x": 0.962343}, {"y": 0.01211, "x": 0.946027}, {"y": 0.01574, "x": 0.926971}, {"y": 0.019752, "x": 0.905287}, {"y": 0.024079, "x": 0.881104}, {"y": 0.028653, "x": 0.854565}, {"y": 0.033404, "x": 0.82583}, {"y": 0.03826, "x": 0.795069}, {"y": 0.043149, "x": 0.762469}, {"y": 0.048, "x": 0.728228}, {"y": 0.052741, "x": 0.692554}, {"y": 0.057302, "x": 0.655665}, {"y": 0.061615, "x": 0.617788}, {"y": 0.065609, "x": 0.579155}, {"y": 0.06922, "x": 0.540008}, {"y": 0.072381, "x": 0.500588}, {"y": 0.075034, "x": 0.461143}, {"y": 0.077122, "x": 0.421921}, {"y": 0.078574, "x": 0.383032}, {"y": 0.079198, "x": 0.34468}, {"y": 0.078941, "x": 0.307289}, {"y": 0.077802, "x": 0.271106}, {"y": 0.075794, "x": 0.236371}, {"y": 0.072947, "x": 0.203313}, {"y": 0.069309, "x": 0.172151}, {"y": 0.064941, "x": 0.143088}, {"y": 0.059918, "x": 0.116313}, {"y": 0.054325, "x": 0.091996}, {"y": 0.048257, "x": 0.070289}, {"y": 0.041808, "x": 0.051324}, {"y": 0.035076, "x": 0.035214}, {"y": 0.028152, "x": 0.022051}, {"y": 0.02112, "x": 0.011907}, {"y": 0.014049, "x": 0.004833}, {"y": 0.006997, "x": 0.00086}, {"y": 0.0, "x": 0.0}, {"y": -0.006689, "x": 0.002223}, {"y": -0.012828, "x": 0.007479}, {"y": -0.018404, "x": 0.015723}, {"y": -0.023408, "x": 0.026892}, {"y": -0.027826, "x": 0.040906}, {"y": -0.031651, "x": 0.057669}, {"y": -0.034878, "x": 0.077071}, {"y": -0.037507, "x": 0.098987}, {"y": -0.039546, "x": 0.123281}, {"y": -0.041013, "x": 0.149805}, {"y": -0.041934, "x": 0.178401}, {"y": -0.042346, "x": 0.208902}, {"y": -0.042294, "x": 0.241131}, {"y": -0.041834, "x": 0.274904}, {"y": -0.041027, "x": 0.310028}, {"y": -0.039941, "x": 0.346303}, {"y": -0.038644, "x": 0.383522}, {"y": -0.037174, "x": 0.421644}, {"y": -0.035444, "x": 0.460397}, {"y": -0.033493, "x": 0.499412}, {"y": -0.031373, "x": 0.538451}, {"y": -0.029138, "x": 0.577279}, {"y": -0.026833, "x": 0.615658}, {"y": -0.0245, "x": 0.653352}, {"y": -0.022172, "x": 0.690129}, {"y": -0.01988, "x": 0.725762}, {"y": -0.017649, "x": 0.760029}, {"y": -0.015499, "x": 0.792716}, {"y": -0.013448, "x": 0.823619}, {"y": -0.01151, "x": 0.852541}, {"y": -0.009701, "x": 0.879302}, {"y": -0.008033, "x": 0.90373}, {"y": -0.00652, "x": 0.925669}, {"y": -0.005174, "x": 0.944979}, {"y": -0.004008, "x": 0.961536}, {"y": -0.003035, "x": 0.975232}, {"y": -0.002265, "x": 0.985978}, {"y": -0.001708, "x": 0.993705}, {"y": -0.00137, "x": 0.998361}, {"y": -0.001257, "x": 0.999916}]];
        
        var elems = []
        for(var path of paths) {
            var panels = [];
            for(let i = 0, n = path.length; i < n; ++i) {
                var p1 = path[i];
                var p2 = path[(i+1) % n];

                var point1 = new VP.Point(p1.x, p1.y);
                var point2 = new VP.Point(p2.x, p2.y);
                var dx = p2.x - p1.x;
                var dy = p2.y - p1.y;
                var len = Math.sqrt(dx*dx + dy*dy);
                var panel = new VP.Panel(point1, point2, len);
                panels.push(panel);
            }
            elems.push(panels)
        }

        this.ls = new VP.LinearSystem(elems);
    }

    velocity(p) {
        return this.ls.computeVelocity(p);
    }
}

export default Simulation;